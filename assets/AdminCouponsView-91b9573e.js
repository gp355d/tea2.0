import{m as x,D as y}from"./DelModal-9100e539.js";import{_ as g,o as l,c as a,a as o,E as u,J as _,d as $,t as r,K as k,r as b,F as D,C as P,b as C}from"./index-fc53acef.js";import{P as V}from"./PaginationView-8b80f5a3.js";import{S as c}from"./sweetalert2.all-67e5945f.js";const E={props:["coupon","isNew"],data(){return{tempCoupon:{},due_date:""}},mixins:[x],watch:{coupon(){this.tempCoupon=this.coupon;const s=new Date(this.tempCoupon.due_date*1e3).toISOString().split("T");[this.due_date]=s,console.log(s)},due_date(){this.tempCoupon.due_date=Math.floor(new Date(this.due_date)/1e3)}}},N={class:"modal fade",id:"couponModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},T={class:"modal-dialog",role:"document"},B={class:"modal-content"},U={class:"modal-header"},A={class:"modal-title",id:"exampleModalLabel"},L={key:0},S={key:1},I=o("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),R={class:"modal-body"},O={class:"mb-3"},F=o("label",{for:"title"},"標題",-1),H={class:"mb-3"},J=o("label",{for:"coupon_code"},"優惠碼",-1),K={class:"mb-3"},j=o("label",{for:"due_date"},"到期日",-1),q={class:"mb-3"},z=o("label",{for:"price"},"折扣百分比",-1),G={class:"mb-3"},Q={class:"form-check"},W=o("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),X={class:"modal-footer"},Y=o("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close",-1);function Z(s,e,n,m,t,d){return l(),a("div",N,[o("div",T,[o("div",B,[o("div",U,[o("h5",A,[n.isNew?(l(),a("span",L,"新增優惠卷")):(l(),a("span",S,"編輯優惠卷"))]),I]),o("div",R,[o("div",O,[F,u(o("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":e[0]||(e[0]=i=>t.tempCoupon.title=i),placeholder:"請輸入標題"},null,512),[[_,t.tempCoupon.title]])]),o("div",H,[J,u(o("input",{type:"text",class:"form-control",id:"coupon_code","onUpdate:modelValue":e[1]||(e[1]=i=>t.tempCoupon.code=i),placeholder:"請輸入優惠碼"},null,512),[[_,t.tempCoupon.code]])]),o("div",K,[j,$(" "+r(t.due_date)+" ",1),u(o("input",{type:"date",class:"form-control",id:"due_date","onUpdate:modelValue":e[2]||(e[2]=i=>t.due_date=i)},null,512),[[_,t.due_date]])]),o("div",q,[z,u(o("input",{type:"number",min:"0",max:"100",class:"form-control",id:"price","onUpdate:modelValue":e[3]||(e[3]=i=>t.tempCoupon.percent=i),placeholder:"請輸入折扣百分比"},null,512),[[_,t.tempCoupon.percent,void 0,{number:!0}]])]),o("div",G,[o("div",Q,[u(o("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":e[4]||(e[4]=i=>t.tempCoupon.is_enabled=i),id:"is_enabled"},null,512),[[k,t.tempCoupon.is_enabled]]),W])])]),o("div",X,[Y,o("button",{type:"button",class:"btn btn-primary",onClick:e[5]||(e[5]=()=>s.$emit("update-coupon",t.tempCoupon))},r(n.isNew?"新增優惠卷":"更新優惠券"),1)])])])],512)}const oo=g(E,[["render",Z]]),{VITE_APP_URL:h,VITE_APP_PATH:f}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/",VITE_APP_PATH:"leo533",BASE_URL:"/Vue3-week6/",MODE:"production",DEV:!1,PROD:!0},eo={data(){return{coupons:{},tempCoupon:{title:"",is_enabled:0,percent:100,code:""},isNew:!1,pagination:{}}},methods:{getCoupons(s=1){const e=this.$loading.show();this.$http.get(`${h}v2/api/${f}/admin/coupons/?page=${s}`).then(n=>{this.coupons=n.data.coupons,this.pagination=n.data.pagination,e.hide()}).catch(n=>{c.fire({position:"top-end",icon:"error",title:n.response.data.message,showConfirmButton:!1,timer:1500}),e.hide()})},openModal(s,e){s==="new"?(this.tempCoupon={due_date:new Date().getTime()/1e3},this.isNew=!0):s==="edit"&&(this.tempCoupon={...e},this.isNew=!1),this.$refs.couponModal.openModal()},openDelmodal(s){this.tempCoupon={...s},this.$refs.coupondelModal.openModal()},updateCoupon(s){if(s.percent>100||s.percent<=0)return c.fire({position:"top-end",icon:"error",title:"折扣百分比不能為負值或100以上",showConfirmButton:!1,timer:1500}),0;let e=`${h}v2/api/${f}/admin/coupon`,n="post",m=s;this.isNew||(e=`${h}v2/api/${f}/admin/coupon/${this.tempCoupon.id}`,n="put",m=this.tempCoupon),this.$http[n](e,{data:m}).then(t=>{c.fire({position:"top-end",icon:"success",title:t.data.message,showConfirmButton:!1,timer:1500}),this.getCoupons(),this.$refs.couponModal.hideModal()}).catch(t=>{c.fire({position:"top-end",icon:"error",title:t.response.data.message,showConfirmButton:!1,timer:1500})})},deleteCoupon(){const s=`${h}v2/api/${f}/admin/coupon/${this.tempCoupon.id}`;this.$http.delete(s).then(e=>{c.fire({position:"top-end",icon:"success",title:e.data.message,showConfirmButton:!1,timer:1500}),this.$refs.coupondelModal.hideModal(),this.getCoupons()}).catch(e=>{c.fire({position:"top-end",icon:"error",title:e.response.data.message,showConfirmButton:!1,timer:1500})})}},components:{CouponsModal:oo,DelModal:y,Pagination:V},mounted(){this.getCoupons(),document.title=this.$route.meta.title}},to={class:"col-md-9 ms-sm-auto col-lg-10 px-md-4"},so={class:"py-3"},no={class:"text-end mt-4"},io={class:"table-responsive"},lo={class:"table mt-4"},ao=o("thead",null,[o("tr",null,[o("th",null,"名稱"),o("th",{class:"text-nowrap"},"折扣百分比"),o("th",null,"到期日"),o("th",{class:"text-nowrap"},"是否啟用"),o("th",null,"操作行為")])],-1),po={class:"text-nowrap"},co={key:0,class:"text-success"},uo={key:1,class:"text-muted"},ro={class:"text-nowrap"},mo={class:"btn-group"},_o=["onClick"],ho=["onClick"];function fo(s,e,n,m,t,d){const i=b("CouponsModal"),w=b("DelModal"),v=b("Pagination");return l(),a("main",to,[o("div",so,[o("div",no,[o("button",{class:"btn btn-primary",type:"button",onClick:e[0]||(e[0]=()=>d.openModal("new"))}," 建立新的優惠券 ")]),o("div",io,[o("table",lo,[ao,o("tbody",null,[(l(!0),a(D,null,P(t.coupons,(p,M)=>(l(),a("tr",{key:M},[o("td",po,r(p.title),1),o("td",null,r(p.percent)+"%",1),o("td",null,r(s.$filters.date(p.due_date)),1),o("td",null,[p.is_enabled===1?(l(),a("span",co,"啟用")):(l(),a("span",uo,"未啟用"))]),o("td",ro,[o("div",mo,[o("button",{class:"btn btn-outline-primary btn-sm",onClick:()=>d.openModal("edit",p)},"編輯",8,_o),o("button",{class:"btn btn-outline-danger btn-sm",onClick:()=>d.openDelmodal(p)},"刪除",8,ho)])])]))),128))])])]),C(i,{ref:"couponModal",coupon:t.tempCoupon,"is-new":t.isNew,onUpdateCoupon:d.updateCoupon},null,8,["coupon","is-new","onUpdateCoupon"]),C(w,{ref:"coupondelModal","temp-items":t.tempCoupon,onDeleteData:d.deleteCoupon,id:3},null,8,["temp-items","onDeleteData"]),C(v,{pages:t.pagination,onEmitPages:d.getCoupons},null,8,["pages","onEmitPages"])])])}const vo=g(eo,[["render",fo]]);export{vo as default};
