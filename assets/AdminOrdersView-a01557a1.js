import{m as V,D as E}from"./DelModal-9100e539.js";import{_ as w,o,c as n,a as t,d as A,t as s,D as O,F as m,C as k,E as $,K as v,r as f,b,A as B}from"./index-fc53acef.js";import{P as S}from"./PaginationView-8b80f5a3.js";import{S as _}from"./sweetalert2.all-67e5945f.js";const T={props:["order"],data(){return{tempOrder:{},isPaid:!1}},methods:{changestatus(l){this.$emit("change-status",l)}},watch:{order(){this.tempOrder=this.order}},mixins:[V]},L={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},N={class:"modal-dialog modal-xl",role:"document"},U={class:"modal-content border-0"},I=t("div",{class:"modal-header bg-dark text-white"},[t("h5",{class:"modal-title",id:"exampleModalLabel"},[t("span",null,"訂單細節")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),R={class:"modal-body"},q={class:"row"},F={class:"col-md-4"},H=t("h3",null,"用戶資料",-1),j={class:"table"},z={key:0},K=t("th",{style:{width:"100px"}},"姓名",-1),G=t("th",null,"Email",-1),J=t("th",null,"電話",-1),Q=t("th",null,"地址",-1),W={class:"col-md-8"},X=t("h3",null,"訂單細節",-1),Y={class:"table"},Z=t("th",{style:{width:"100px"}},"訂單編號",-1),tt=t("th",null,"下單時間",-1),et=t("th",null,"付款時間",-1),st={key:0},ot={key:1},nt=t("th",null,"付款狀態",-1),lt={key:0,class:"text-success"},dt={key:1,class:"text-muted"},rt=t("th",null,"總金額",-1),at=t("h3",null,"選購商品",-1),it={class:"table"},ct=t("thead",null,[t("tr")],-1),pt={class:"text-end"},ht={class:"d-flex justify-content-end"},_t={class:"form-check"},ut={class:"form-check-label",for:"flexCheckDefault"},mt={key:0},ft={key:1},bt={class:"modal-footer"},gt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function yt(l,d,a,p,e,c){return o(),n("div",L,[t("div",N,[t("div",U,[I,t("div",R,[t("div",q,[t("div",F,[A(s(e.tempOrder.paid_date)+" ",1),H,t("table",j,[e.tempOrder.user?(o(),n("tbody",z,[t("tr",null,[K,t("td",null,s(e.tempOrder.user.name),1)]),t("tr",null,[G,t("td",null,s(e.tempOrder.user.email),1)]),t("tr",null,[J,t("td",null,s(e.tempOrder.user.tel),1)]),t("tr",null,[Q,t("td",null,s(e.tempOrder.user.address),1)])])):O("",!0)])]),t("div",W,[X,t("table",Y,[t("tbody",null,[t("tr",null,[Z,t("td",null,s(e.tempOrder.id),1)]),t("tr",null,[tt,t("td",null,s(l.$filters.date(e.tempOrder.create_at)),1)]),t("tr",null,[et,t("td",null,[e.tempOrder.paid_date?(o(),n("span",st,s(l.$filters.date(e.tempOrder.paid_date)),1)):(o(),n("span",ot,"時間不正確"))])]),t("tr",null,[nt,t("td",null,[e.tempOrder.is_paid?(o(),n("strong",lt,"已付款")):(o(),n("span",dt,"尚未付款"))])]),t("tr",null,[rt,t("td",null,s(l.$filters.currency(e.tempOrder.total)),1)])])]),at,t("table",it,[ct,t("tbody",null,[(o(!0),n(m,null,k(e.tempOrder.products,i=>{var u;return o(),n("tr",{key:i.id},[t("th",null,s((u=i.product)==null?void 0:u.title),1),t("td",null,s(i.qty)+" / "+s(i.product.unit),1),t("td",pt,s(i.final_Total),1)])}),128))])]),t("div",ht,[t("div",_t,[$(t("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":d[0]||(d[0]=i=>e.tempOrder.is_paid=i)},null,512),[[v,e.tempOrder.is_paid]]),t("label",ut,[e.tempOrder.is_paid?(o(),n("span",mt,"已付款")):(o(),n("span",ft,"未付款"))])])])])])]),t("div",bt,[gt,t("button",{type:"button",class:"btn btn-primary",onClick:d[1]||(d[1]=()=>c.changestatus(e.tempOrder))}," 修改付款狀態 ")])])])],512)}const Ot=w(T,[["render",yt]]),{VITE_APP_URL:g,VITE_APP_PATH:y}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/",VITE_APP_PATH:"leo533",BASE_URL:"/Vue3-week6/",MODE:"production",DEV:!1,PROD:!0},kt={data(){return{orders:{},isNew:!1,pagination:{},tempOrder:{}}},methods:{getOrders(l=1){const d=this.$loading.show();this.$http.get(`${g}v2/api/${y}/admin/orders/?page=${l}`).then(a=>{this.orders=a.data.orders,this.pagination=a.data.pagination,d.hide()}).catch(a=>{_.fire({position:"top-end",icon:"error",title:a.response.data.message,showConfirmButton:!1,timer:1500}),d.hide()})},openModal(l,d){l==="look"?(this.tempOrder={...d},this.isNew=!1,this.$refs.orderModal.openModal()):l==="delete"&&(this.tempOrder={...d},this.$refs.orderdelModal.openModal())},updatePaid(l){const d=`${g}v2/api/${y}/admin/order/${l.id}`,a={is_paid:l.is_paid};this.$http.put(d,{data:a}).then(p=>{_.fire({position:"top-end",icon:"success",title:p.data.message,showConfirmButton:!1,timer:1500}),this.$refs.orderModal.hideModal()}).catch(p=>{_.fire({position:"top-end",icon:"error",title:p.response.data.message,showConfirmButton:!1,timer:1500})})},deleteOrder(){const l=`${g}v2/api/${y}/admin/order/${this.tempOrder.id}`;this.$http.delete(l).then(d=>{_.fire({position:"top-end",icon:"success",title:d.data.message,showConfirmButton:!1,timer:1500}),this.$refs.orderdelModal.hideModal(),this.getOrders()}).catch(d=>{_.fire({position:"top-end",icon:"error",title:d.response.data.message,showConfirmButton:!1,timer:1500})})}},components:{OrderModal:Ot,DelModal:E,Pagination:S},mounted(){this.getOrders(),document.title=this.$route.meta.title}},xt={class:"col-md-9 ms-sm-auto col-lg-10 px-md-4"},Ct={class:"py-3"},wt={class:"table-responsive"},$t={class:"table mt-4"},vt=t("thead",null,[t("tr",null,[t("th",null,"購買時間"),t("th",{class:"text-nowrap"},"Email"),t("th",{class:"text-nowrap"},"購買款項"),t("th",{class:"text-nowrap"},"應付金額"),t("th",{class:"text-nowrap"},"是否付款"),t("th",{class:"text-nowrap"},"操作行為")])],-1),Mt={class:"text-nowrap"},Pt=["textContent"],Dt={class:"text-nowrap"},Vt={class:"text-right text-nowrap"},Et={class:"text-nowrap"},At={class:"form-check form-switch"},Bt=["id","onUpdate:modelValue","onChange"],St=["for"],Tt={key:0},Lt={key:1},Nt={class:"text-nowrap"},Ut={class:"btn-group"},It=["onClick"],Rt=["onClick"];function qt(l,d,a,p,e,c){const i=f("OrderModal"),u=f("DelModal"),M=f("Pagination");return o(),n("main",xt,[t("div",Ct,[t("div",wt,[t("table",$t,[vt,t("tbody",null,[(o(!0),n(m,null,k(e.orders,(r,P)=>(o(),n(m,{key:P},[e.orders.length?(o(),n("tr",{key:0,class:B({"text-secondary":!r.is_paid})},[t("td",null,s(l.$filters.date(r.create_at)),1),t("td",Mt,[r.user?(o(),n("span",{key:0,textContent:s(r.user.email)},null,8,Pt)):O("",!0)]),t("td",Dt,[(o(!0),n(m,null,k(r.products,(h,D)=>{var x,C;return o(),n("ul",{class:"list-unstyled",key:D},[t("li",null,s((x=h.product)==null?void 0:x.title)+" 數量："+s(h.qty)+" "+s((C=h.product)==null?void 0:C.unit),1)])}),128))]),t("td",Vt,s(l.$filters.currency(r.total)),1),t("td",Et,[t("div",At,[$(t("input",{class:"form-check-input",type:"checkbox",id:`paidSwitch${r.id}`,"onUpdate:modelValue":h=>r.is_paid=h,onChange:()=>c.updatePaid(r)},null,40,Bt),[[v,r.is_paid]]),t("label",{class:"form-check-label",for:`paidSwitch${r.id}`},[r.is_paid?(o(),n("span",Tt,"已付款")):(o(),n("span",Lt,"未付款"))],8,St)])]),t("td",Nt,[t("div",Ut,[t("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:()=>c.openModal("look",r)}," 檢視 ",8,It),t("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:()=>c.openModal("delete",r)}," 刪除 ",8,Rt)])])],2)):O("",!0)],64))),128))])]),b(i,{ref:"orderModal",order:e.tempOrder,onChangeStatus:c.updatePaid},null,8,["order","onChangeStatus"]),b(u,{ref:"orderdelModal","temp-items":e.tempOrder,onDeleteData:c.deleteOrder,id:2},null,8,["temp-items","onDeleteData"]),b(M,{pages:e.pagination,onEmitPages:c.getOrders},null,8,["pages","onEmitPages"])])])])}const Kt=w(kt,[["render",qt]]);export{Kt as default};
