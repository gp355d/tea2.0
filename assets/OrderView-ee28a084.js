import{_ as T,m as _,f as A,L as E,r as c,o as m,c as u,b as a,a as e,w as g,F as L,C as B,E as w,J as C,B as I,t as p,d as j,A as f}from"./index-fc53acef.js";import{c as h}from"./cart-c07dfcd8.js";import{s as q}from"./statusStore-d1ac195f.js";import{S as v}from"./sweetalert2.all-67e5945f.js";const{VITE_APP_URL:x,VITE_APP_PATH:k}={VITE_APP_URL:"https://vue3-course-api.hexschool.io/",VITE_APP_PATH:"leo533",BASE_URL:"/Vue3-week6/",MODE:"production",DEV:!1,PROD:!0},D={data(){return{form:{email:"",name:"",phone:"",address:"",region:"",msg:""},couponCode:"",discount:0,discoutStatus:!1}},computed:{..._(h,["carts"]),..._(h,["final_total"]),..._(h,["total","isLoading"]),..._(q,["isLoading"])},methods:{...A(h,["getCarts"]),validateTelephone(l){return/^(09)[0-9]{8}$/.test(l)?!0:"請輸入09開頭的手機號碼"},sendCoupon(l){this.couponCode=l;const s={code:this.couponCode};console.log(s),this.$http.post(`${x}v2/api/${k}/coupon`,{data:s}).then(i=>{console.log(i),this.discoutStatus=i.data.success,v.fire({position:"top-end",icon:"success",title:i.data.message,showConfirmButton:!1,timer:1500})}).catch(i=>(v.fire({position:"top-end",icon:"error",title:i.response.data.message,showConfirmButton:!1,timer:1500}),0)),this.couponCode=""},sendOrder(){if(console.log(this.carts.length),this.carts.length===0)alert("購物車清單內為空");else{const l={user:{name:this.form.name,email:this.form.email,tel:this.form.phone,address:this.form.address},message:this.form.msg},s=this.$loading.show();this.$http.post(`${x}v2/api/${k}/order`,{data:l}).then(i=>{console.log("送出訂單:",i),this.getCarts(),this.loadingItem="",this.$refs.form.resetForm(),v.fire({position:"top-end",icon:"success",title:"訂單已送出",showConfirmButton:!1,timer:1500}),this.$router.push(`/complete/${i.data.orderId}`),s.hide()}).catch(i=>{v.fire({position:"top-end",icon:"error",title:i.response.data.message,showConfirmButton:!1,timer:1500})})}}},components:{Loading:E},mounted(){this.getCarts()}},N={class:"container py-8"},O=e("h2",{class:"text-center fw-bold text-primary mb-7"},"填寫訂單",-1),M={class:"row justify-content-center flex-column flex-md-row"},R={class:"col-md-9 mb-3 d-flex flex-column justify-content-between"},F={class:"row"},H={class:"col-md-6"},z={class:"border p-2 h-100"},J=e("h3",{class:"text-center fw-bold text-primary"},"訂單明細",-1),X={class:"col-4"},G=["src"],K={class:"col-3"},Q={class:"fs-6 fs-md-4 mb-0"},W={class:"col-3 text-end"},Y={class:"fs-6 fs-md-4"},Z={class:"col-2 text-end"},$={class:"col-2 fs-6 fs-md-4"},ee={class:"d-flex justify-content-center"},se={class:"d-flex justify-content-between fs-5"},oe=e("span",null,"總和",-1),te={key:0},le={key:1},ne={class:"col-md-6"},ae={class:"p-2"},ie=e("h3",{class:"text-center fw-bold text-primary"},"顧客資訊",-1),re={class:"mb-3"},de=e("label",{for:"customer-name",class:"form-label"},"姓名",-1),ce={class:"mb-3"},me=e("label",{for:"customer-emall",class:"form-label"},"Email",-1),ue={class:"mb-3"},pe=e("label",{for:"customer-phone",class:"form-label"},"電話",-1),fe={class:"mb-3"},_e=e("label",{for:"customer-address",class:"form-label"},"地址",-1),he={class:"mb-3"},ve=e("label",{for:"customer-pay",class:"form-label"},"付款方式",-1),be=e("option",{value:"",disabled:""},"請選擇",-1),ge=e("option",{value:"1"},"ATM",-1),ye=e("option",{value:"2"},"Cradit Card",-1),Ve=e("option",{value:"3"},"samsung pay",-1),we={class:"mb-3"},Ce=e("label",{for:"customer-note",class:"form-label"},"備註",-1),xe=e("div",{class:"text-end"},[e("button",{type:"submit",class:"btn btn-primary"},"送出訂單")],-1);function ke(l,s,i,Se,o,b){const S=c("loading"),U=c("router-link"),r=c("v-field"),d=c("error-message"),P=c("v-form");return m(),u("div",N,[a(S,{active:l.isLoading,"onUpdate:active":s[0]||(s[0]=t=>l.isLoading=t)},null,8,["active"]),O,e("div",M,[e("div",R,[e("div",F,[e("div",H,[a(U,{to:"/products"},{default:g(()=>[j("回購物車列表")]),_:1}),e("div",z,[J,(m(!0),u(L,null,B(l.carts.carts,t=>{var n,y,V;return m(),u("div",{class:"d-flex align-items-center mb-4 shadow-sm p-2",key:t.id},[e("div",X,[e("img",{class:"col-4 object-fit p-1 w-100 img-fluid",src:(n=t.product)==null?void 0:n.imageUrl,alt:"order-img",height:"150"},null,8,G)]),e("div",K,[e("span",Q,p((y=t.product)==null?void 0:y.title),1)]),e("div",W,[e("span",Y,p(l.$filters.currency((V=t.product)==null?void 0:V.price)),1)]),e("div",Z,[e("span",$,"X"+p(t.qty),1)])])}),128)),e("div",ee,[w(e("input",{type:"text",class:"form-control","onUpdate:modelValue":s[1]||(s[1]=t=>o.couponCode=t)},null,512),[[C,o.couponCode]]),e("button",{class:"btn btn-primary text-nowrap",type:"button",onClick:s[2]||(s[2]=I(()=>b.sendCoupon(o.couponCode),["prevent"]))},"套用優惠碼")]),e("div",se,[oe,o.discoutStatus?(m(),u("span",te,p(l.$filters.currency(l.final_total)),1)):(m(),u("span",le,p(l.$filters.currency(l.total)),1))])])]),e("div",ne,[a(P,{ref:"form",onSubmit:b.sendOrder},{default:g(({errors:t})=>[e("div",ae,[ie,e("div",re,[de,a(r,{type:"text",name:"姓名",class:f(["form-control",{"is-invalid":t.姓名}]),id:"customer-name",placeholder:"請填寫姓名",rules:"required",modelValue:o.form.name,"onUpdate:modelValue":s[3]||(s[3]=n=>o.form.name=n)},null,8,["class","modelValue"]),a(d,{name:"姓名",class:"invalid-feedback"})]),e("div",ce,[me,a(r,{type:"email",name:"信箱",class:f(["form-control",{"is-invalid":t.信箱}]),id:"customer-emall",placeholder:"name@example.com",rules:"email|required",modelValue:o.form.email,"onUpdate:modelValue":s[4]||(s[4]=n=>o.form.email=n)},null,8,["class","modelValue"]),a(d,{name:"信箱",class:"invalid-feedback"})]),e("div",ue,[pe,a(r,{type:"tel",name:"電話",class:f(["form-control",{"is-invalid":t.電話}]),id:"customer-phone",placeholder:"0912345678",rules:b.validateTelephone,modelValue:o.form.phone,"onUpdate:modelValue":s[5]||(s[5]=n=>o.form.phone=n)},null,8,["class","rules","modelValue"]),a(d,{name:"電話",class:"invalid-feedback"})]),e("div",fe,[_e,a(r,{type:"text",name:"地址",class:f(["form-control",{"is-invalid":t.地址}]),id:"customer-address",placeholder:"請輸入地址",rules:"required",modelValue:o.form.address,"onUpdate:modelValue":s[6]||(s[6]=n=>o.form.address=n)},null,8,["class","modelValue"]),a(d,{name:"地址",class:"invalid-feedback"})]),e("div",he,[ve,a(r,{id:"customer-pay",name:"付款方式",class:f(["form-control",{"is-invalid":t.付款方式}]),rules:"required",modelValue:o.form.region,"onUpdate:modelValue":s[7]||(s[7]=n=>o.form.region=n),as:"select"},{default:g(()=>[be,ge,ye,Ve]),_:2},1032,["class","modelValue"]),a(d,{name:"付款方式",class:"invalid-feedback"})]),e("div",we,[Ce,w(e("textarea",{class:"form-control",id:"customer-note",rows:"3","onUpdate:modelValue":s[8]||(s[8]=n=>o.form.msg=n)},null,512),[[C,o.form.msg]])]),xe])]),_:1},8,["onSubmit"])])])])])])}const Ee=T(D,[["render",ke]]);export{Ee as default};
